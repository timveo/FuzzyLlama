# OpenAPI Specification Template
#
# PURPOSE: This is the API CONTRACT between Frontend and Backend.
# Both agents MUST implement exactly what this spec defines.
#
# ARCHITECT: Fill in all [PLACEHOLDERS] based on PRD requirements
# VALIDATION: Run `swagger-cli validate openapi.yaml` before handoff
#
openapi: 3.0.3
info:
  title: "[PROJECT_NAME] API"
  version: "1.0.0"
  description: |
    API specification for [PROJECT_NAME].

    ## Authentication
    [AUTH_DESCRIPTION - e.g., "JWT Bearer tokens required for authenticated endpoints"]

    ## Rate Limiting
    [RATE_LIMIT_DESCRIPTION - e.g., "100 requests per minute per IP"]

    ## Error Handling
    All errors follow the standard error response schema.

servers:
  - url: http://localhost:3001/api/v1
    description: Development
  - url: https://api.[PROJECT_DOMAIN]/v1
    description: Production

tags:
  - name: Auth
    description: Authentication endpoints
  - name: Users
    description: User management
  # [ADD MORE TAGS FOR EACH DOMAIN]

paths:
  #############################################################################
  # AUTHENTICATION ENDPOINTS
  #############################################################################
  /auth/register:
    post:
      operationId: register
      summary: Register a new user
      tags: [Auth]
      security: []  # No auth required
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: "user@example.com"
              password: "SecurePass123!"
              name: "John Doe"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'

  /auth/login:
    post:
      operationId: login
      summary: Authenticate user and get tokens
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      operationId: refreshToken
      summary: Refresh access token
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      operationId: logout
      summary: Logout user (invalidate refresh token)
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Logged out successfully
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/me:
    get:
      operationId: getCurrentUser
      summary: Get current authenticated user
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  #############################################################################
  # USER ENDPOINTS
  #############################################################################
  /users:
    get:
      operationId: listUsers
      summary: List all users (admin only)
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: role
          in: query
          schema:
            $ref: '#/components/schemas/UserRole'
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /users/{id}:
    get:
      operationId: getUser
      summary: Get user by ID
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      operationId: updateUser
      summary: Update user
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteUser
      summary: Delete user (admin only)
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '204':
          description: User deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  #############################################################################
  # [DOMAIN] ENDPOINTS - Copy this section for each domain
  #############################################################################
  # /[resources]:
  #   get:
  #     operationId: list[Resources]
  #     summary: List all [resources]
  #     tags: [[Domain]]
  #     ...

components:
  #############################################################################
  # SECURITY SCHEMES
  #############################################################################
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT access token obtained from /auth/login or /auth/refresh.
        Token expires in 15 minutes.

  #############################################################################
  # REUSABLE PARAMETERS
  #############################################################################
  parameters:
    UserIdParam:
      name: id
      in: path
      required: true
      description: User UUID
      schema:
        type: string
        format: uuid

    PageParam:
      name: page
      in: query
      description: Page number (1-indexed)
      schema:
        type: integer
        minimum: 1
        default: 1

    LimitParam:
      name: limit
      in: query
      description: Items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

  #############################################################################
  # REUSABLE RESPONSES
  #############################################################################
  responses:
    BadRequest:
      description: Invalid request data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "VALIDATION_ERROR"
              message: "Invalid request data"
              details:
                - field: "email"
                  message: "Invalid email format"

    Unauthorized:
      description: Authentication required or invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "UNAUTHORIZED"
              message: "Authentication required"

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "FORBIDDEN"
              message: "Insufficient permissions"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "NOT_FOUND"
              message: "Resource not found"

    Conflict:
      description: Resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: "CONFLICT"
              message: "Email already registered"

  #############################################################################
  # SCHEMAS
  #############################################################################
  schemas:
    #--------------------------------------------------------------------------
    # ENUMS (Must match Prisma enums exactly)
    #--------------------------------------------------------------------------
    UserRole:
      type: string
      enum: [USER, ADMIN]
      description: User role in the system

    # [ADD MORE ENUMS - Must match Prisma schema exactly]

    #--------------------------------------------------------------------------
    # AUTH SCHEMAS
    #--------------------------------------------------------------------------
    RegisterRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          maxLength: 255
        password:
          type: string
          minLength: 8
          maxLength: 72
          description: Must contain uppercase, lowercase, and number
        name:
          type: string
          maxLength: 100

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    RefreshRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string

    AuthResponse:
      type: object
      required: [success, data]
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          required: [user, accessToken, refreshToken]
          properties:
            user:
              $ref: '#/components/schemas/User'
            accessToken:
              type: string
              description: JWT access token (15 min expiry)
            refreshToken:
              type: string
              description: Refresh token (30 day expiry)

    TokenResponse:
      type: object
      required: [success, data]
      properties:
        success:
          type: boolean
        data:
          type: object
          required: [accessToken]
          properties:
            accessToken:
              type: string

    #--------------------------------------------------------------------------
    # USER SCHEMAS
    #--------------------------------------------------------------------------
    User:
      type: object
      required: [id, email, role, createdAt]
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
          nullable: true
        role:
          $ref: '#/components/schemas/UserRole'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserResponse:
      type: object
      required: [success, data]
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/User'

    UserListResponse:
      type: object
      required: [success, data, meta]
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/User'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/UserRole'
          description: Admin only

    #--------------------------------------------------------------------------
    # [DOMAIN] SCHEMAS - Add for each domain
    #--------------------------------------------------------------------------
    # [Resource]:
    #   type: object
    #   required: [id, ...]
    #   properties:
    #     id:
    #       type: string
    #       format: uuid
    #     ...

    #--------------------------------------------------------------------------
    # COMMON SCHEMAS
    #--------------------------------------------------------------------------
    PaginationMeta:
      type: object
      required: [page, limit, total, totalPages]
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    ErrorResponse:
      type: object
      required: [success, error]
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          required: [code, message]
          properties:
            code:
              type: string
              description: Machine-readable error code
              enum:
                - VALIDATION_ERROR
                - UNAUTHORIZED
                - FORBIDDEN
                - NOT_FOUND
                - CONFLICT
                - RATE_LIMITED
                - INTERNAL_ERROR
            message:
              type: string
              description: Human-readable error message
            details:
              type: array
              description: Field-level validation errors
              items:
                type: object
                properties:
                  field:
                    type: string
                  message:
                    type: string
